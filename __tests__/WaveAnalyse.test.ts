import Wave from "../src/Wave";
import WaveAnalyse from "../src/WaveAnalyse";
import fs from "fs";

describe("WaveAnalyseのテスト", () => {
  test("PreEmphasis", () => {
    const wa = new WaveAnalyse();
    const result1 = wa.PreEmphasis([0.1, 0.2, 0.3, 0.4, 0.5]);
    const answer1 = new Array(0.1, 0.103, 0.106, 0.109, 0.112);
    for (let i = 0; i < result1.length; i++) {
      expect(result1[i]).toBeCloseTo(answer1[i]);
    }
    const result2 = wa.PreEmphasis([0.1, 0.2, 0.3, 0.4, 0.5], 0.5);
    const answer2 = new Array(0.1, 0.15, 0.2, 0.25, 0.3);
    for (let i = 0; i < result1.length; i++) {
      expect(result2[i]).toBeCloseTo(answer2[i]);
    }
  });

  test("makeWindow_none", () => {
    const wa = new WaveAnalyse();
    expect(wa.MakeWindow("a", 10)).toEqual([1, 1, 1, 1, 1, 1, 1, 1, 1, 1]);
  });
  test("makeWindow_hanning", () => {
    const wa = new WaveAnalyse();
    const result1 = wa.MakeWindow("hanning", 10);
    const answer1 = new Array(
      0,
      0.095492,
      0.345492,
      0.654508,
      0.904508,
      1,
      0.904508,
      0.654508,
      0.345492,
      0.095492
    );
    for (let i = 0; i < result1.length; i++) {
      expect(result1[i]).toBeCloseTo(answer1[i]);
    }
  });
  test("makeWindow_hamming", () => {
    const wa = new WaveAnalyse();
    const result1 = wa.MakeWindow("hamming", 10);
    const answer1 = new Array(
      0.08,
      0.167852,
      0.397852,
      0.682148,
      0.912148,
      1,
      0.912148,
      0.682148,
      0.397852,
      0.167852
    );
    for (let i = 0; i < result1.length; i++) {
      expect(result1[i]).toBeCloseTo(answer1[i]);
    }
  });
  test("power", () => {
    const wa = new WaveAnalyse();
    const result1 = wa.Power(
      [0.1, -0.2, 0.3, -0.4, 0.5, -0.6, 0.7, -0.8, 0.9, -1],
      1,
      3,
      "a",
      1,
      0
    );
    const answer1 = new Array(
      -13.30993219,
      -10.14723257,
      -7.781512504,
      -5.906305295,
      -4.357285696,
      -3.039349863,
      -1.893195248,
      -0.879551704,
      -0.433514208,
      0
    );
    for (let i = 0; i < result1.length; i++) {
      expect(result1[i]).toBeCloseTo(answer1[i]);
    }
  });
  test("power_pre", () => {
    const wa = new WaveAnalyse();
    const result1 = wa.Power(
      [0.1, -0.2, 0.3, -0.4, 0.5, -0.6, 0.7, -0.8, 0.9, -1],
      1,
      3,
      "a",
      1
    );
    const answer1 = new Array(
      -9.427841427,
      -5.687831702,
      -2.981267634,
      -0.891533473,
      0.803008845,
      2.22559542,
      3.450429657,
      4.525298798,
      4.994880999,
      5.450755548
    );
    for (let i = 0; i < result1.length; i++) {
      expect(result1[i]).toBeCloseTo(answer1[i]);
    }
  });
  test("power_pre_hanning", () => {
    const wa = new WaveAnalyse();
    const result1 = wa.Power(
      [0.1, -0.2, 0.3, -0.4, 0.5, -0.6, 0.7, -0.8, 0.9, -1],
      1,
      3,
      "hanning",
      10
    );
    const answer1 = new Array(
      -20.00961685,
      -17.04655174,
      -14.83780483,
      -13.0771239,
      -11.61332274,
      -10.3607038,
      -9.266002417,
      -8.293852074,
      -17.96020462,
      -Infinity
    );
    for (let i = 0; i < result1.length; i++) {
      expect(result1[i]).toBeCloseTo(answer1[i]);
    }
  });
  test("f0_8192", () => {
    const wa = new WaveAnalyse();
    const buffer = fs.readFileSync(
      "./__tests__/test_data/error_test_dcoffset_20240623.wav"
    );
    const ab = new ArrayBuffer(buffer.length);
    const safeData = new Uint8Array(ab);
    for (let i = 0; i < buffer.length; i++) {
      safeData[i] = buffer[i];
    }
    const wav = new Wave(safeData.buffer);
    const pythonAnswer = [
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819, 588.0,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369, 588.0,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369, 588.0, 588.0,
      588.0, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0,
      588.0, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0,
      588.0, 588.0, 595.9459459459459, 595.9459459459459, 595.9459459459459,
      595.9459459459459, 595.9459459459459, 595.9459459459459,
      604.1095890410959, 595.9459459459459, 595.9459459459459,
      595.9459459459459, 595.9459459459459, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 268.9024390243902, 260.94674556213016,
      242.30769230769232, 240.98360655737704, 239.67391304347825,
      234.5744680851064, 234.5744680851064, 234.5744680851064,
      234.5744680851064, 234.5744680851064, 233.33333333333334,
      233.33333333333334, 233.33333333333334, 233.33333333333334,
      232.10526315789474, 232.10526315789474, 232.10526315789474,
      232.10526315789474, 232.10526315789474, 232.10526315789474,
      232.10526315789474, 232.10526315789474, 232.10526315789474,
      232.10526315789474, 233.33333333333334, 233.33333333333334,
      233.33333333333334, 233.33333333333334, 233.33333333333334,
      233.33333333333334, 233.33333333333334, 233.33333333333334,
      234.5744680851064, 234.5744680851064, 234.5744680851064,
      234.5744680851064, 234.5744680851064, 234.5744680851064,
      234.5744680851064, 234.5744680851064, 234.5744680851064,
      235.8288770053476, 235.8288770053476, 235.8288770053476,
      235.8288770053476, 237.09677419354838, 237.09677419354838,
      238.3783783783784, 238.3783783783784, 238.3783783783784,
      239.67391304347825, 239.67391304347825, 240.98360655737704,
      240.98360655737704, 240.98360655737704, 242.30769230769232,
      242.30769230769232, 242.30769230769232, 242.30769230769232,
      243.646408839779, 243.646408839779, 243.646408839779, 243.646408839779,
      243.646408839779, 243.646408839779, 243.646408839779, 243.646408839779,
      245.0, 245.0, 245.0, 245.0, 245.0, 245.0, 245.0, 245.0, 245.0, 245.0,
      245.0, 245.0, 246.3687150837989, 246.3687150837989, 247.75280898876406,
      249.15254237288136, 249.15254237288136, 252.0, 253.44827586206895,
      254.91329479768785, 256.3953488372093, 256.3953488372093,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 256.3953488372093, 256.3953488372093,
      256.3953488372093, 256.3953488372093, 256.3953488372093,
      256.3953488372093, 256.3953488372093, 254.91329479768785,
      254.91329479768785, 254.91329479768785, 254.91329479768785,
      254.91329479768785, 253.44827586206895, 253.44827586206895,
      253.44827586206895, 253.44827586206895, 252.0, 252.0, 252.0, 252.0, 252.0,
      252.0, 252.0, 250.5681818181818, 250.5681818181818, 250.5681818181818,
      250.5681818181818, 250.5681818181818, 250.5681818181818,
      250.5681818181818, 250.5681818181818, 250.5681818181818,
      250.5681818181818, 250.5681818181818, 250.5681818181818,
      249.15254237288136, 249.15254237288136, 249.15254237288136,
      249.15254237288136, 249.15254237288136, 249.15254237288136,
      249.15254237288136, 249.15254237288136, 249.15254237288136,
      249.15254237288136, 249.15254237288136, 249.15254237288136,
      249.15254237288136, 249.15254237288136, 249.15254237288136,
      249.15254237288136, 249.15254237288136, 249.15254237288136,
      249.15254237288136, 249.15254237288136, 249.15254237288136,
      249.15254237288136, 249.15254237288136, 249.15254237288136,
      249.15254237288136, 249.15254237288136, 250.5681818181818,
      250.5681818181818, 250.5681818181818, 250.5681818181818,
      250.5681818181818, 250.5681818181818, 250.5681818181818, 252.0, 252.0,
      253.44827586206895, 253.44827586206895, 253.44827586206895,
      254.91329479768785, 256.3953488372093, 257.89473684210526,
      259.4117647058824, 259.4117647058824, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 264.07185628742513,
      265.66265060240966, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 265.66265060240966, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      265.66265060240966, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513, 262.5, 262.5,
      262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5,
      262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5,
      262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5,
      262.5, 262.5, 264.07185628742513, 264.07185628742513, 264.07185628742513,
      265.66265060240966, 265.66265060240966, 267.27272727272725,
      268.9024390243902, 267.27272727272725, 268.9024390243902,
      267.27272727272725, 267.27272727272725, 267.27272727272725,
      267.27272727272725, 267.27272727272725, 267.27272727272725,
      267.27272727272725, 267.27272727272725, 265.66265060240966,
      265.66265060240966, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 265.66265060240966, 265.66265060240966,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 262.5, 262.5, 262.5,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 262.5, 262.5, 262.5, 262.5, 262.5,
      262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5,
      262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 262.5, 262.5, 260.94674556213016,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 260.94674556213016, 260.94674556213016, 262.5, 262.5,
      262.5, 262.5, 260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      260.94674556213016, 260.94674556213016, 260.94674556213016, 262.5, 262.5,
      259.4117647058824, 260.94674556213016, 525.0, 537.8048780487804,
      531.3253012048193, 537.8048780487804, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 773.6842105263158,
      711.2903225806451, 773.6842105263158, 773.6842105263158,
      773.6842105263158, 773.6842105263158, 773.6842105263158,
      773.6842105263158, 773.6842105263158, 773.6842105263158,
      773.6842105263158, 773.6842105263158, 773.6842105263158,
      711.2903225806451, 711.2903225806451, 773.6842105263158,
      773.6842105263158, 773.6842105263158, 773.6842105263158,
      773.6842105263158, 773.6842105263158, 773.6842105263158,
      773.6842105263158, 773.6842105263158, 773.6842105263158,
      773.6842105263158, 773.6842105263158, 773.6842105263158,
      773.6842105263158, 773.6842105263158, 773.6842105263158,
      773.6842105263158, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819,
    ];
    if (wav.data) {
      const f0 = wa.F0(wav.data, 44100, 8192, 256, 80, 800, 0.02);
      expect(f0.length).toBe(pythonAnswer.length);
      f0.forEach((f, i) => {
        expect(f).toBeCloseTo(pythonAnswer[i]);
      });
    }
  });

  test("f0_4096", () => {
    const wa = new WaveAnalyse();
    const buffer = fs.readFileSync(
      "./__tests__/test_data/error_test_dcoffset_20240623.wav"
    );
    const ab = new ArrayBuffer(buffer.length);
    const safeData = new Uint8Array(ab);
    for (let i = 0; i < buffer.length; i++) {
      safeData[i] = buffer[i];
    }
    const wav = new Wave(safeData.buffer);
    const pythonAnswer = [
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      580.2631578947369, 801.8181818181819, 572.7272727272727,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369, 588.0,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 588.0, 588.0, 580.2631578947369,
      580.2631578947369, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0,
      580.2631578947369, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0, 588.0,
      588.0, 588.0, 595.9459459459459, 588.0, 595.9459459459459,
      595.9459459459459, 595.9459459459459, 595.9459459459459,
      595.9459459459459, 595.9459459459459, 595.9459459459459,
      595.9459459459459, 595.9459459459459, 595.9459459459459,
      595.9459459459459, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      565.3846153846154, 531.3253012048193, 268.9024390243902,
      260.94674556213016, 242.30769230769232, 240.98360655737704,
      239.67391304347825, 234.5744680851064, 234.5744680851064,
      234.5744680851064, 234.5744680851064, 234.5744680851064,
      233.33333333333334, 233.33333333333334, 233.33333333333334,
      233.33333333333334, 232.10526315789474, 232.10526315789474,
      232.10526315789474, 232.10526315789474, 232.10526315789474,
      232.10526315789474, 232.10526315789474, 232.10526315789474,
      232.10526315789474, 232.10526315789474, 232.10526315789474,
      232.10526315789474, 233.33333333333334, 233.33333333333334,
      233.33333333333334, 233.33333333333334, 234.5744680851064,
      234.5744680851064, 235.8288770053476, 235.8288770053476,
      235.8288770053476, 235.8288770053476, 237.09677419354838,
      237.09677419354838, 237.09677419354838, 237.09677419354838,
      238.3783783783784, 238.3783783783784, 239.67391304347825,
      239.67391304347825, 240.98360655737704, 240.98360655737704,
      240.98360655737704, 242.30769230769232, 242.30769230769232,
      242.30769230769232, 242.30769230769232, 243.646408839779,
      243.646408839779, 243.646408839779, 245.0, 245.0, 245.0, 245.0, 245.0,
      245.0, 245.0, 245.0, 245.0, 245.0, 246.3687150837989, 246.3687150837989,
      246.3687150837989, 246.3687150837989, 246.3687150837989,
      246.3687150837989, 246.3687150837989, 245.0, 245.0, 245.0,
      246.3687150837989, 247.75280898876406, 247.75280898876406,
      506.8965517241379, 292.05298013245033, 284.51612903225805, 262.5, 262.5,
      260.94674556213016, 259.4117647058824, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      256.3953488372093, 256.3953488372093, 254.91329479768785,
      254.91329479768785, 254.91329479768785, 253.44827586206895,
      253.44827586206895, 253.44827586206895, 253.44827586206895,
      253.44827586206895, 252.0, 252.0, 252.0, 252.0, 252.0, 252.0, 252.0,
      252.0, 252.0, 250.5681818181818, 250.5681818181818, 250.5681818181818,
      250.5681818181818, 250.5681818181818, 250.5681818181818,
      250.5681818181818, 250.5681818181818, 250.5681818181818,
      250.5681818181818, 250.5681818181818, 249.15254237288136,
      249.15254237288136, 249.15254237288136, 249.15254237288136,
      247.75280898876406, 247.75280898876406, 247.75280898876406,
      247.75280898876406, 247.75280898876406, 247.75280898876406,
      247.75280898876406, 247.75280898876406, 247.75280898876406,
      247.75280898876406, 249.15254237288136, 249.15254237288136,
      249.15254237288136, 249.15254237288136, 250.5681818181818,
      250.5681818181818, 250.5681818181818, 250.5681818181818,
      250.5681818181818, 252.0, 252.0, 252.0, 252.0, 253.44827586206895,
      253.44827586206895, 253.44827586206895, 253.44827586206895,
      253.44827586206895, 253.44827586206895, 253.44827586206895,
      253.44827586206895, 252.0, 245.0, 243.646408839779, 242.30769230769232,
      151.02739726027397, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 265.66265060240966, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5,
      262.5, 262.5, 262.5, 262.5, 262.5, 260.94674556213016, 262.5, 262.5,
      262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5,
      262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5,
      260.94674556213016, 262.5, 259.4117647058824, 259.4117647058824,
      260.94674556213016, 270.55214723926383, 565.3846153846154,
      565.3846153846154, 280.89171974522293, 280.89171974522293,
      279.11392405063293, 275.625, 273.9130434782609, 272.22222222222223,
      270.55214723926383, 270.55214723926383, 268.9024390243902,
      268.9024390243902, 267.27272727272725, 267.27272727272725,
      267.27272727272725, 265.66265060240966, 265.66265060240966,
      265.66265060240966, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513, 262.5, 262.5,
      262.5, 262.5, 260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 262.5, 262.5, 262.5, 262.5, 262.5,
      262.5, 262.5, 264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 264.07185628742513, 264.07185628742513,
      264.07185628742513, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5, 262.5,
      262.5, 262.5, 262.5, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 259.4117647058824, 262.5, 250.5681818181818,
      233.33333333333334, 279.11392405063293, 277.35849056603774,
      267.27272727272725, 265.66265060240966, 264.07185628742513, 262.5, 262.5,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      257.89473684210526, 257.89473684210526, 256.3953488372093,
      254.91329479768785, 531.3253012048193, 537.8048780487804,
      544.4444444444445, 544.4444444444445, 544.4444444444445,
      270.55214723926383, 267.27272727272725, 264.07185628742513, 262.5, 262.5,
      260.94674556213016, 260.94674556213016, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      257.89473684210526, 257.89473684210526, 256.3953488372093,
      257.89473684210526, 257.89473684210526, 256.3953488372093,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      257.89473684210526, 257.89473684210526, 257.89473684210526,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 260.94674556213016, 260.94674556213016,
      260.94674556213016, 259.4117647058824, 259.4117647058824,
      259.4117647058824, 259.4117647058824, 259.4117647058824,
      260.94674556213016, 260.94674556213016, 260.94674556213016, 262.5,
      260.94674556213016, 259.4117647058824, 260.94674556213016,
      259.4117647058824, 267.27272727272725, 531.3253012048193,
      531.3253012048193, 525.0, 537.8048780487804, 531.3253012048193,
      537.8048780487804, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 773.6842105263158, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      580.2631578947369, 580.2631578947369, 580.2631578947369,
      711.2903225806451, 773.6842105263158, 747.457627118644, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 787.5, 787.5, 787.5, 787.5, 801.8181818181819, 787.5,
      787.5, 787.5, 787.5, 787.5, 787.5, 787.5, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819, 801.8181818181819, 801.8181818181819,
      801.8181818181819,
    ];
    if (wav.data) {
      const f0 = wa.F0(wav.data, 44100, 4096, 256, 80, 800, 0.02);
      expect(f0.length).toBe(pythonAnswer.length);
      f0.forEach((f, i) => {
        expect(f).toBeCloseTo(pythonAnswer[i]);
      });
    }
  });
});
