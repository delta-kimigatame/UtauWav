!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.UtauWav=e():t.UtauWav=e()}(self,(()=>(()=>{"use strict";var t={540:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t=0,e=0){this.re=t,this.sub=e}Expi(t){return this.re=Math.cos(t),this.sub=Math.sin(t),this}Add(t){return new a(this.re+t.re,this.sub+t.sub)}Sub(t){return new a(this.re-t.re,this.sub-t.sub)}Mul(t){return new a(this.re*t.re-this.sub*t.sub,this.re*t.sub+this.sub*t.re)}}e.default=a},95:function(t,e,a){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=s(a(230)),h=s(a(876));e.default=class{constructor(t){var e,a,s;if(this.header=new i.default(t),t.byteLength<=this.header.dataIndex)return console.warn("このwavはヘッダ部分しかありません。"),this.data_=null,void(this.rData_=null);if(t.slice(this.header.dataIndex).byteLength%this.blockSize!=0)return console.warn("このwavのデータ部分に欠損があるため読み込まれませんでした。"),this.data_=null,void(this.rData_=null);const h=t.slice(this.header.dataIndex).byteLength/this.blockSize,r=new DataView(t.slice(this.header.dataIndex));this.data_=new Array,2===this.channels?this.rData_=new Array:this.rData_=null;for(let t=0;t<h;t++)8===this.bitDepth?(this.data_.push(r.getInt8(t*this.blockSize)),2===this.channels&&(null===(e=this.rData_)||void 0===e||e.push(r.getInt8(t*this.blockSize+1)))):16===this.bitDepth?(this.data_.push(r.getInt16(t*this.blockSize,!0)),2===this.channels&&(null===(a=this.rData_)||void 0===a||a.push(r.getInt16(t*this.blockSize+2,!0)))):24===this.bitDepth&&(this.data_.push(this.GetInt24(r,t*this.blockSize)),2===this.channels&&(null===(s=this.rData_)||void 0===s||s.push(this.GetInt24(r,t*this.blockSize+3))))}Output(){const t=new ArrayBuffer(this.header.dataChunkSize),e=new DataView(t),a=this.header.dataChunkSize/this.blockSize;for(let t=0;t<a;t++)null===this.data||(8===this.bitDepth?(e.setInt8(t*this.blockSize,this.data[t]),2===this.channels&&null!==this.rData&&e.setInt8(t*this.blockSize+1,this.rData[t])):16===this.bitDepth?(e.setInt16(t*this.blockSize,this.data[t],!0),2===this.channels&&null!==this.rData&&e.setInt16(t*this.blockSize+2,this.rData[t],!0)):24===this.bitDepth&&(this.SetInt24(e,t*this.blockSize,this.data[t]),2===this.channels&&null!==this.rData&&this.SetInt24(e,t*this.blockSize+3,this.rData[t])));const s=this.header.Output(),i=new Uint8Array(s.byteLength+t.byteLength);return i.set(new Uint8Array(s),0),i.set(new Uint8Array(t),44),i.buffer}GetInt24(t,e){let a=t.getUint16(e,!0)+65536*t.getUint8(e+2);return a>=2**23&&(a-=2**24),a}SetInt24(t,e,a){a<0&&(a+=2**24),t.setUint16(e,65535&a,!0),t.setUint8(e+2,16711680&a)}RemoveDCOffset(){const t=new h.default;null!==this.data&&(this.data_=t.RemoveDCOffset(this.data)),null!==this.rData&&(this.rData_=t.RemoveDCOffset(this.rData))}VolumeNormalize(){const t=new h.default;null!==this.data&&(this.data_=t.VolumeNormalize(this.data,this.bitDepth)),null!==this.rData&&(this.rData_=t.VolumeNormalize(this.rData,this.bitDepth))}LogicalNormalize(t){const e=new h.default;return null===this.data||1!==this.channels&&1!==t?null!==this.rData&&2===t?e.LogicalNormalize(this.rData,this.bitDepth):null:e.LogicalNormalize(this.data,this.bitDepth)}InverseLogicalNormalize(t,e){const a=new h.default;1===this.channels||1===e?this.data_=a.InverseLogicalNormalize(t,this.bitDepth):2===e&&(this.rData_=a.InverseLogicalNormalize(t,this.bitDepth))}get chunksize(){return this.header.chunksize}get channels(){return this.header.channels}set channels(t){this.channels!==t&&(1===t?(this.header.channels=t,this.rData_=null,this.header.blockSize=t*this.bitDepth/8,this.header.bytePerSec=this.blockSize*this.sampleRate):2===t&&null!==this.data_&&(this.header.channels=t,this.rData_=[...this.data_],this.header.blockSize=t*this.bitDepth/8,this.header.bytePerSec=this.blockSize*this.sampleRate))}get sampleRate(){return this.header.sampleRate}set sampleRate(t){if(null!==this.data){const e=this.data.length/this.sampleRate,a=1/this.sampleRate,s=1/t,i=e*t,h=new Array;let r=null;2===this.channels&&(r=new Array);for(let t=0;t<i;t++){const e=s*t/a;if(e===Math.floor(e))h.push(this.data[e]),null!==r&&null!==this.rData&&r.push(this.rData[e]);else{const t=e-Math.floor(e);h.push(this.data[Math.floor(e)]+Math.round((this.data[Math.ceil(e)]-this.data[Math.floor(e)])*t)),null!==r&&null!==this.rData&&r.push(this.rData[Math.floor(e)]+Math.round((this.rData[Math.ceil(e)]-this.rData[Math.floor(e)])*t))}}this.data_=h,this.rData_=r,this.header.sampleRate=t,this.header.bytePerSec=this.blockSize*this.sampleRate;const n=this.blockSize*i;this.header.chunksize=this.header.chunksize-this.header.dataChunkSize+n,this.header.dataChunkSize=this.blockSize*i}}get bytePerSec(){return this.header.bytePerSec}get blockSize(){return this.header.blockSize}get bitDepth(){return this.header.bitDepth}set bitDepth(t){var e,a;if(t%8!=0||t>32)return;const s=new Array;if(null===(e=this.data_)||void 0===e||e.forEach((e=>{s.push(e/2**this.bitDepth*2**t)})),this.data_=s,null!==this.rData){const e=new Array;null===(a=this.rData_)||void 0===a||a.forEach((a=>{e.push(a/2**(this.bitDepth-1)*2**(t-1))})),this.rData_=e}this.header.bitDepth=t,this.header.blockSize=this.channels*this.bitDepth/8,this.header.bytePerSec=this.blockSize*this.sampleRate}get data(){return this.data_}get rData(){return this.rData_}}},266:function(t,e,a){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=s(a(540)),h=a(76);e.default=class{constructor(){}Power(t,e=44100,a=.02,s="hanning",i=.01,h=.97){const r=new Array,n=this.PreEmphasis(t,h),o=a*e,l=i*e,u=this.MakeWindow(s,l);console.log(n);for(let t=0;t<n.length;t++){let e=0;const a=n.slice(t,t+o);console.log(a);for(let t=0;t<a.length;t++)e+=(a[t]*u[t%l])**2;r.push(10*Math.log10(e/a.length))}return r}Spectrogram(t,e=512,a="hamming",s=128,r=.97){const n=new Array,o=this.PreEmphasis(t,r),l=this.MakeWindow(a,s);for(let t=0;t+e<o.length;t++){const a=o.slice(t,t+e),r=new Array;for(let t=0;t<a.length;t++)r.push(new i.default(a[t]*l[t%s]));n.push((0,h.fft)(r))}return n}PreEmphasis(t,e=.97){const a=new Array;a.push(t[0]);for(let s=1;s<t.length;s++)a.push(t[s]-e*t[s-1]);return a}MakeWindow(t,e){const a=new Array;for(let s=0;s<e;s++)"hanning"===t?a.push(.5-.5*Math.cos(2*Math.PI*s/e)):"hamming"===t?a.push(.54-.46*Math.cos(2*Math.PI*s/e)):a.push(1);return a}}},230:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){const e=new TextDecoder,a=new DataView(t);let s=12,i=36;if(t.byteLength<44)throw new RangeError("waveヘッダに欠損があるか、waveファイルではありません。");if("RIFF"!==e.decode(t.slice(0,4)))throw new Error("このデータはwaveファイルではありません。RIFF識別子がありません。");if(this.chunksize_=a.getUint32(4,!0),"WAVE"!==e.decode(t.slice(8,12)))throw new Error("このデータはwaveファイルではありません。WAVE識別子がありません。");for(;"fmt "!==e.decode(t.slice(s,s+4));)if(s++,s+4>t.byteLength)throw new Error("このデータはwaveファイルではありません。fmt 識別子がありません。");if(s+32>t.byteLength)throw new RangeError("waveヘッダに欠損があります。");if(this.fmtChunkSize_=a.getUint32(s+4,!0),this.format_=a.getUint16(s+8,!0),3===this.format_)throw new Error("このwavファイルは32bit floatで記録されており、読み込みできません。");if(6===this.format_)throw new Error("このwavファイルはA-lawコーデックで圧縮されており、読み込みできません。");if(7===this.format_)throw new Error("このwavファイルはu-lawコーデックで圧縮されており、読み込みできません。");if(1!==this.format_)throw new Error("このwavファイルは未知のコーデックで圧縮されており、読み込みできません。");for(this.channels_=a.getUint16(s+10,!0),this.sampleRate_=a.getUint32(s+12,!0),this.bytePerSec_=a.getUint32(s+16,!0),this.blockSize_=a.getUint16(s+20,!0),this.bitDepth_=a.getUint16(s+22,!0);"data"!==e.decode(t.slice(i,i+4));)if(i++,i+4>t.byteLength)throw new Error("このデータはwaveファイルではありません。data識別子がありません。");if(i+8>t.byteLength)throw new RangeError("waveヘッダに欠損があります。");this.dataChunkSize_=a.getUint32(i+4,!0),this.dataIndex_=i+8}Output(){const t=new ArrayBuffer(44),e=new DataView(t);return e.setUint8(0,"R".charCodeAt(0)),e.setUint8(1,"I".charCodeAt(0)),e.setUint8(2,"F".charCodeAt(0)),e.setUint8(3,"F".charCodeAt(0)),e.setUint32(4,this.chunksize,!0),e.setUint8(8,"W".charCodeAt(0)),e.setUint8(9,"A".charCodeAt(0)),e.setUint8(10,"V".charCodeAt(0)),e.setUint8(11,"E".charCodeAt(0)),e.setUint8(12,"f".charCodeAt(0)),e.setUint8(13,"m".charCodeAt(0)),e.setUint8(14,"t".charCodeAt(0)),e.setUint8(15," ".charCodeAt(0)),e.setUint32(16,this.fmtChunkSize,!0),e.setUint16(20,this.format,!0),e.setUint16(22,this.channels,!0),e.setUint32(24,this.sampleRate,!0),e.setUint32(28,this.bytePerSec,!0),e.setUint16(32,this.blockSize,!0),e.setUint16(34,this.bitDepth,!0),e.setUint8(36,"d".charCodeAt(0)),e.setUint8(37,"a".charCodeAt(0)),e.setUint8(38,"t".charCodeAt(0)),e.setUint8(39,"a".charCodeAt(0)),e.setUint32(40,this.dataChunkSize,!0),t}get chunksize(){return this.chunksize_}set chunksize(t){this.chunksize_=t}get fmtChunkSize(){return this.fmtChunkSize_}get format(){return this.format_}get channels(){return this.channels_}set channels(t){this.channels_=t}get sampleRate(){return this.sampleRate_}set sampleRate(t){this.sampleRate_=t}get bytePerSec(){return this.bytePerSec_}set bytePerSec(t){this.bytePerSec_=t}get blockSize(){return this.blockSize_}set blockSize(t){this.blockSize_=t}get bitDepth(){return this.bitDepth_}set bitDepth(t){this.bitDepth_=t}get dataChunkSize(){return this.dataChunkSize_}set dataChunkSize(t){this.dataChunkSize_=t}get dataIndex(){return this.dataIndex_}}},876:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){}RemoveDCOffset(t){const e=t.length;let a=0;t.forEach((t=>{a+=t}));const s=a/e,i=new Array;return t.forEach((t=>{i.push(Math.round(t-s))})),i}VolumeNormalize(t,e){const a=new Array;let s=0;return t.forEach((t=>{Math.abs(t)>s&&(s=Math.abs(t))})),t.forEach((t=>{a.push(Math.round(t/s*(2**(e-1)-1)))})),a}LogicalNormalize(t,e){const a=new Array;return t.forEach((t=>{a.push(t/2**(e-1))})),a}InverseLogicalNormalize(t,e){const a=new Array;return t.forEach((t=>{a.push(Math.round(t*2**(e-1)))})),a}}},156:function(t,e,a){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ifft=e.fft=e.Complex=e.WaveAnalyse=e.WaveProcessing=e.Wave=void 0;var i=a(95);Object.defineProperty(e,"Wave",{enumerable:!0,get:function(){return s(i).default}});const h=s(a(876));e.WaveProcessing=h.default;const r=s(a(266));e.WaveAnalyse=r.default;const n=s(a(540));e.Complex=n.default;const o=a(76);Object.defineProperty(e,"fft",{enumerable:!0,get:function(){return o.fft}}),Object.defineProperty(e,"ifft",{enumerable:!0,get:function(){return o.ifft}})},76:function(t,e,a){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ifft=e.fft=void 0;const i=s(a(540)),h=(t,e,a)=>{const s=Math.log2(a),h=t.map(((e,a)=>t[((t,e)=>{let a=0;for(let s=0;s<t;s++)a=a<<1|e>>>s&1;return a})(s,a)]));for(let t=1;t<a;t*=2){e/=2;for(let s=0;s<a;s+=2*t)for(let a=0;a<t;a++){const r=h[s+a],n=h[s+a+t].Mul((new i.default).Expi(e*a));[h[s+a],h[s+a+t]]=[r.Add(n),r.Sub(n)]}}return h};e.fft=t=>{const e=t.length,a=-2*Math.PI;return h(t,a,e)},e.ifft=t=>{const e=t.length,a=2*Math.PI;return h(t,a,e).map((t=>new i.default(t.re/e,t.sub/e)))}}},e={};return function a(s){var i=e[s];if(void 0!==i)return i.exports;var h=e[s]={exports:{}};return t[s].call(h.exports,h,h.exports,a),h.exports}(156)})()));